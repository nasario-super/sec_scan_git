# Secret Detection Patterns
# Add custom patterns here to extend the default detection capabilities
# Updated: 2026-01-12 - Added Brazilian payment providers and additional patterns

patterns:
  # =====================================================================
  # BRAZILIAN PAYMENT AND SERVICE PROVIDERS
  # =====================================================================
  
  # Mercado Pago
  - name: mercadopago_access_token
    regex: 'APP_USR-\d{10,}-\d{6}-[a-f0-9]{32}-\d+'
    severity: critical
    description: "Mercado Pago Access Token"
    remediation: "Rotate token immediately in Mercado Pago dashboard and use environment variables"
    references:
      - https://www.mercadopago.com.br/developers/pt/docs/your-integrations/credentials

  - name: mercadopago_public_key
    regex: 'APP_USR-[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}'
    severity: medium
    description: "Mercado Pago Public Key"
    remediation: "Public keys are less sensitive but should still use environment variables"

  # PagSeguro
  - name: pagseguro_token
    regex: '[A-F0-9]{32}'
    severity: high
    context_required: true
    context_patterns:
      - pagseguro
      - sandbox\.pagseguro
      - ws\.pagseguro
    description: "PagSeguro Token"
    remediation: "Rotate token in PagSeguro dashboard"

  - name: pagseguro_email_token
    regex: '(?i)pagseguro[_-]?(token|email)["\']?\s*[:=]\s*["\']?([^\s"\']+)'
    severity: high
    description: "PagSeguro Email/Token Configuration"
    remediation: "Use environment variables for PagSeguro credentials"

  # Cielo
  - name: cielo_merchant_key
    regex: '[a-zA-Z0-9]{40}'
    severity: critical
    context_required: true
    context_patterns:
      - cielo
      - merchantkey
      - merchant_key
    description: "Cielo Merchant Key"
    remediation: "Rotate key in Cielo dashboard immediately"

  # Stone
  - name: stone_api_key
    regex: '(?i)stone[_-]?(api[_-]?key|token)["\']?\s*[:=]\s*["\']?([A-Za-z0-9_-]{20,})'
    severity: critical
    description: "Stone API Key"
    remediation: "Rotate key in Stone dashboard"

  # Pagar.me
  - name: pagarme_api_key
    regex: 'ak_(live|test)_[A-Za-z0-9]{24,}'
    severity: critical
    description: "Pagar.me API Key"
    remediation: "Rotate key in Pagar.me dashboard and use environment variables"

  # iugu
  - name: iugu_api_token
    regex: '[a-f0-9]{32}'
    severity: high
    context_required: true
    context_patterns:
      - iugu
      - api\.iugu
    description: "iugu API Token"
    remediation: "Rotate token in iugu dashboard"

  # Asaas
  - name: asaas_api_key
    regex: '\$aact_[A-Za-z0-9]{50,}'
    severity: critical
    description: "Asaas API Key"
    remediation: "Rotate key in Asaas dashboard"

  # Gerencianet / Efí
  - name: gerencianet_client_id
    regex: 'Client_Id_[a-f0-9]{40,}'
    severity: high
    description: "Gerencianet/Efí Client ID"
    remediation: "Use environment variables for Gerencianet credentials"

  # =====================================================================
  # BRAZILIAN DOCUMENT NUMBERS (CPF/CNPJ as identifiers)
  # =====================================================================
  
  - name: cpf_in_code
    regex: '\b\d{3}\.\d{3}\.\d{3}-\d{2}\b'
    severity: medium
    description: "CPF (Brazilian Individual Taxpayer ID) exposed in code"
    remediation: "Remove personal identifiers from source code"
    exclude_patterns:
      - example
      - test
      - mock
      - '000\.000\.000-00'
      - '111\.111\.111-11'
      - '123\.456\.789-00'

  - name: cnpj_in_code
    regex: '\b\d{2}\.\d{3}\.\d{3}/\d{4}-\d{2}\b'
    severity: medium
    description: "CNPJ (Brazilian Company ID) exposed in code"
    remediation: "Remove company identifiers from source code"
    exclude_patterns:
      - example
      - test
      - '00\.000\.000/0000-00'

  # =====================================================================
  # ADDITIONAL CLOUD AND SAAS PROVIDERS
  # =====================================================================
  
  # DataDog
  - name: datadog_api_key
    regex: '[a-f0-9]{32}'
    severity: high
    context_required: true
    context_patterns:
      - datadog
      - dd_api
      - DD_API_KEY
    description: "DataDog API Key"
    remediation: "Rotate key in DataDog and use environment variables"

  - name: datadog_app_key
    regex: '[a-f0-9]{40}'
    severity: high
    context_required: true
    context_patterns:
      - datadog
      - dd_app
      - DD_APP_KEY
    description: "DataDog Application Key"
    remediation: "Rotate key in DataDog settings"

  # New Relic
  - name: newrelic_license_key
    regex: '[a-f0-9]{40}'
    severity: high
    context_required: true
    context_patterns:
      - newrelic
      - new_relic
      - NEW_RELIC
    description: "New Relic License Key"
    remediation: "Rotate key in New Relic account settings"

  - name: newrelic_api_key
    regex: 'NRAK-[A-Z0-9]{27}'
    severity: high
    description: "New Relic API Key"
    remediation: "Rotate in New Relic API Keys section"

  # PagerDuty
  - name: pagerduty_api_key
    regex: '[a-zA-Z0-9+/]{20}'
    severity: high
    context_required: true
    context_patterns:
      - pagerduty
      - PAGERDUTY
    description: "PagerDuty API Key"
    remediation: "Rotate key in PagerDuty settings"

  # Sentry
  - name: sentry_dsn
    regex: 'https://[a-f0-9]{32}@[^/]+\.ingest\.sentry\.io/\d+'
    severity: high
    description: "Sentry DSN (Data Source Name)"
    remediation: "Rotate DSN in Sentry project settings"

  - name: sentry_auth_token
    regex: '[a-f0-9]{64}'
    severity: high
    context_required: true
    context_patterns:
      - sentry
      - SENTRY_AUTH
    description: "Sentry Auth Token"
    remediation: "Rotate token in Sentry settings"

  # Cloudflare
  - name: cloudflare_api_key
    regex: '[a-f0-9]{37}'
    severity: critical
    context_required: true
    context_patterns:
      - cloudflare
      - CF_API
    description: "Cloudflare API Key"
    remediation: "Rotate key in Cloudflare dashboard"

  - name: cloudflare_api_token
    regex: '[A-Za-z0-9_-]{40}'
    severity: critical
    context_required: true
    context_patterns:
      - cloudflare
      - CF_TOKEN
    description: "Cloudflare API Token"
    remediation: "Rotate token in Cloudflare dashboard"

  # DigitalOcean
  - name: digitalocean_token
    regex: 'dop_v1_[a-f0-9]{64}'
    severity: critical
    description: "DigitalOcean Personal Access Token"
    remediation: "Rotate token in DigitalOcean control panel"

  - name: digitalocean_spaces_key
    regex: '[A-Z0-9]{20}'
    severity: high
    context_required: true
    context_patterns:
      - digitalocean
      - spaces
      - DO_SPACES
    description: "DigitalOcean Spaces Access Key"
    remediation: "Rotate key in Spaces settings"

  # Vercel
  - name: vercel_token
    regex: '[A-Za-z0-9]{24}'
    severity: high
    context_required: true
    context_patterns:
      - vercel
      - VERCEL_TOKEN
    description: "Vercel Token"
    remediation: "Rotate token in Vercel account settings"

  # Netlify
  - name: netlify_token
    regex: '[a-zA-Z0-9_-]{40,}'
    severity: high
    context_required: true
    context_patterns:
      - netlify
      - NETLIFY
    description: "Netlify Personal Access Token"
    remediation: "Rotate token in Netlify user settings"

  # Supabase
  - name: supabase_key
    regex: 'eyJ[A-Za-z0-9_-]*\.eyJ[A-Za-z0-9_-]*\.[A-Za-z0-9_-]*'
    severity: critical
    context_required: true
    context_patterns:
      - supabase
      - SUPABASE
    description: "Supabase API Key (JWT format)"
    remediation: "Rotate key in Supabase project settings"

  - name: supabase_service_role
    regex: 'sbp_[a-f0-9]{40}'
    severity: critical
    description: "Supabase Service Role Key"
    remediation: "Rotate immediately - this key bypasses Row Level Security"

  # Firebase
  - name: firebase_api_key
    regex: 'AIza[0-9A-Za-z_-]{35}'
    severity: high
    description: "Firebase API Key"
    remediation: "Restrict API key in Firebase console"

  - name: firebase_admin_sdk
    regex: '"type"\s*:\s*"service_account"[^}]*firebase'
    severity: critical
    description: "Firebase Admin SDK Service Account"
    remediation: "Rotate service account in Firebase console"

  # =====================================================================
  # AUTHENTICATION AND IDENTITY PROVIDERS
  # =====================================================================
  
  # Auth0
  - name: auth0_client_secret
    regex: '[A-Za-z0-9_-]{64}'
    severity: critical
    context_required: true
    context_patterns:
      - auth0
      - AUTH0_CLIENT_SECRET
    description: "Auth0 Client Secret"
    remediation: "Rotate secret in Auth0 application settings"

  # Okta
  - name: okta_api_token
    regex: '00[a-zA-Z0-9_-]{40}'
    severity: critical
    context_required: true
    context_patterns:
      - okta
      - OKTA
    description: "Okta API Token"
    remediation: "Rotate token in Okta admin console"

  # Keycloak
  - name: keycloak_client_secret
    regex: '[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}'
    severity: high
    context_required: true
    context_patterns:
      - keycloak
      - client_secret
    description: "Keycloak Client Secret"
    remediation: "Rotate secret in Keycloak admin console"

  # =====================================================================
  # MESSAGING AND COMMUNICATION
  # =====================================================================
  
  # Telegram Bot
  - name: telegram_bot_token
    regex: '\d{9,10}:[A-Za-z0-9_-]{35}'
    severity: high
    description: "Telegram Bot Token"
    remediation: "Revoke token via @BotFather and create new one"

  # Discord
  - name: discord_bot_token
    regex: '[MN][A-Za-z\d]{23,}\.[\w-]{6}\.[\w-]{27}'
    severity: critical
    description: "Discord Bot Token"
    remediation: "Regenerate token in Discord Developer Portal"

  - name: discord_webhook
    regex: 'https://discord(?:app)?\.com/api/webhooks/\d+/[A-Za-z0-9_-]+'
    severity: high
    description: "Discord Webhook URL"
    remediation: "Delete and recreate webhook in channel settings"

  # WhatsApp Business (Meta)
  - name: whatsapp_business_token
    regex: 'EAA[A-Za-z0-9]{100,}'
    severity: critical
    description: "WhatsApp Business API Token (Meta)"
    remediation: "Rotate token in Meta Business settings"

  # =====================================================================
  # CI/CD AND DEVOPS
  # =====================================================================
  
  # CircleCI
  - name: circleci_token
    regex: '[a-f0-9]{40}'
    severity: high
    context_required: true
    context_patterns:
      - circleci
      - CIRCLE_TOKEN
    description: "CircleCI API Token"
    remediation: "Rotate token in CircleCI user settings"

  # Travis CI
  - name: travis_token
    regex: '[a-zA-Z0-9]{22}'
    severity: high
    context_required: true
    context_patterns:
      - travis
      - TRAVIS_TOKEN
    description: "Travis CI API Token"
    remediation: "Rotate token in Travis CI settings"

  # GitLab
  - name: gitlab_token
    regex: 'glpat-[A-Za-z0-9_-]{20}'
    severity: critical
    description: "GitLab Personal Access Token"
    remediation: "Rotate token in GitLab user settings"

  - name: gitlab_runner_token
    regex: 'GR1348941[A-Za-z0-9_-]{20}'
    severity: critical
    description: "GitLab Runner Registration Token"
    remediation: "Reset token in GitLab project CI/CD settings"

  # Bitbucket
  - name: bitbucket_app_password
    regex: '[A-Za-z0-9]{24}'
    severity: high
    context_required: true
    context_patterns:
      - bitbucket
      - BITBUCKET
    description: "Bitbucket App Password"
    remediation: "Revoke and create new app password in Bitbucket"

  # =====================================================================
  # ORIGINAL PATTERNS (maintained for compatibility)
  # =====================================================================

  # AWS
  - name: aws_access_key
    regex: 'AKIA[0-9A-Z]{16}'
    severity: critical
    description: "AWS Access Key ID"
    remediation: "Use IAM roles or AWS Secrets Manager instead of hardcoded keys"
    references:
      - https://docs.aws.amazon.com/secretsmanager/

  - name: aws_secret_key
    regex: '(?<![A-Za-z0-9/+=])[A-Za-z0-9/+=]{40}(?![A-Za-z0-9/+=])'
    severity: critical
    description: "AWS Secret Access Key"
    context_required: true
    context_patterns:
      - aws
      - secret
      - access
    remediation: "Use IAM roles or AWS Secrets Manager"

  # GitHub
  - name: github_token
    regex: 'gh[pousr]_[A-Za-z0-9]{36,}'
    severity: critical
    description: "GitHub Personal Access Token"
    remediation: "Use GitHub Apps or fine-grained tokens with minimal permissions"

  - name: github_fine_grained
    regex: 'github_pat_[A-Za-z0-9]{22}_[A-Za-z0-9]{59}'
    severity: critical
    description: "GitHub Fine-grained Personal Access Token"
    remediation: "Rotate the token and use environment variables"

  # Private Keys
  - name: private_key_rsa
    regex: '-----BEGIN RSA PRIVATE KEY-----'
    severity: critical
    description: "RSA Private Key"
    multiline: true
    entropy_check: false
    remediation: "Never commit private keys. Use a secrets manager."

  - name: private_key_openssh
    regex: '-----BEGIN OPENSSH PRIVATE KEY-----'
    severity: critical
    description: "OpenSSH Private Key"
    multiline: true
    entropy_check: false
    remediation: "Never commit private keys. Use a secrets manager."

  # Generic
  - name: generic_api_key
    regex: '(?i)(api[_-]?key|apikey|api[_-]?secret)\s*[=:]\s*["\']?([A-Za-z0-9_-]{16,})["\']?'
    severity: high
    description: "Generic API Key"
    remediation: "Use environment variables for API keys"
    exclude_patterns:
      - example
      - placeholder
      - your[_-]?api
      - '\$\{'
      - '<api'

  - name: generic_password
    regex: '(?i)(password|passwd|pwd|secret)\s*[=:]\s*["\']([^"\']{8,})["\']'
    severity: high
    description: "Hardcoded Password"
    remediation: "Never hardcode passwords. Use environment variables or a secrets manager."
    exclude_patterns:
      - password.*example
      - password.*placeholder
      - 'password.*\$\{'
      - getenv
      - environ

  # Database
  - name: database_url
    regex: '(mysql|postgresql|postgres|mongodb|redis|amqp)://[^:]+:[^@]+@[^\s"''"]+'
    severity: critical
    description: "Database Connection String with Credentials"
    remediation: "Use environment variables for database credentials"

  # Slack
  - name: slack_webhook
    regex: 'https://hooks\.slack\.com/services/T[A-Z0-9]+/B[A-Z0-9]+/[A-Za-z0-9]+'
    severity: high
    description: "Slack Webhook URL"
    remediation: "Use environment variables for webhook URLs"

  - name: slack_token
    regex: 'xox[baprs]-[A-Za-z0-9-]+'
    severity: critical
    description: "Slack API Token"
    remediation: "Use environment variables and rotate the token"

  # Payment Services
  - name: stripe_secret_key
    regex: 'sk_(live|test)_[A-Za-z0-9]{24,}'
    severity: critical
    description: "Stripe Secret Key"
    remediation: "Use environment variables. Never expose live keys."
    references:
      - https://stripe.com/docs/keys

  - name: stripe_publishable_key
    regex: 'pk_(live|test)_[A-Za-z0-9]{24,}'
    severity: medium
    description: "Stripe Publishable Key"
    confidence: 0.7
    remediation: "Publishable keys are less sensitive but should still use env vars"

  # Email Services
  - name: sendgrid_key
    regex: 'SG\.[A-Za-z0-9_-]{22}\.[A-Za-z0-9_-]{43}'
    severity: high
    description: "SendGrid API Key"
    remediation: "Use environment variables for SendGrid keys"

  - name: mailgun_key
    regex: 'key-[A-Za-z0-9]{32}'
    severity: high
    description: "Mailgun API Key"
    remediation: "Use environment variables"

  # Cloud Providers
  - name: azure_storage
    regex: 'DefaultEndpointsProtocol=https;AccountName=[^;]+;AccountKey=[A-Za-z0-9+/=]{88}'
    severity: critical
    description: "Azure Storage Account Key"
    remediation: "Use Azure Key Vault or managed identities"

  - name: gcp_service_account
    regex: '"type"\s*:\s*"service_account"'
    severity: critical
    description: "GCP Service Account Key File"
    file_patterns:
      - "*.json"
    entropy_check: false
    remediation: "Use workload identity or store in a secrets manager"

  - name: google_api_key
    regex: 'AIza[0-9A-Za-z_-]{35}'
    severity: high
    description: "Google API Key"
    remediation: "Restrict API key and use environment variables"

  # Communication
  - name: twilio_key
    regex: 'SK[a-z0-9]{32}'
    severity: high
    description: "Twilio API Key"
    remediation: "Use environment variables for Twilio credentials"

  # Package Managers
  - name: npm_token
    regex: '//registry\.npmjs\.org/:_authToken=[A-Za-z0-9-]+'
    severity: high
    description: "NPM Auth Token"
    remediation: "Use environment variables and .npmrc.local"

  - name: pypi_token
    regex: 'pypi-[A-Za-z0-9_-]{50,}'
    severity: high
    description: "PyPI API Token"
    remediation: "Use environment variables for PyPI tokens"

  # JWT
  - name: jwt_token
    regex: 'eyJ[A-Za-z0-9-_]+\.eyJ[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+'
    severity: high
    description: "JWT Token"
    min_entropy: 4.0
    remediation: "Do not hardcode JWTs. Generate them dynamically."

# =====================================================================
# ADDITIONAL GENERIC PATTERNS
# =====================================================================

  # Bearer Tokens in headers
  - name: bearer_token_header
    regex: '(?i)bearer\s+[A-Za-z0-9_\-\.]{20,}'
    severity: high
    description: "Bearer Token in Authorization Header"
    remediation: "Remove hardcoded bearer token and use environment variables"

  # Basic Auth Headers
  - name: basic_auth_header
    regex: '(?i)basic\s+[A-Za-z0-9+/=]{20,}'
    severity: high
    description: "Basic Auth Credentials (Base64)"
    remediation: "Decode and rotate credentials, use environment variables"

  # SSH Private Key (content)
  - name: ssh_private_key_base64
    regex: 'AAAA[A-Za-z0-9+/]{100,}'
    severity: critical
    description: "SSH Private Key Content (Base64)"
    remediation: "Rotate SSH key immediately"

  # PGP Private Key
  - name: pgp_private_key
    regex: '-----BEGIN PGP PRIVATE KEY BLOCK-----'
    severity: critical
    description: "PGP Private Key"
    multiline: true
    entropy_check: false
    remediation: "Never commit PGP private keys"

  # X.509 Private Key
  - name: x509_private_key
    regex: '-----BEGIN PRIVATE KEY-----'
    severity: critical
    description: "X.509 Private Key"
    multiline: true
    entropy_check: false
    remediation: "Never commit private keys"

  # Encrypted Key (might still be sensitive)
  - name: encrypted_private_key
    regex: '-----BEGIN ENCRYPTED PRIVATE KEY-----'
    severity: high
    description: "Encrypted Private Key (still sensitive)"
    multiline: true
    entropy_check: false
    remediation: "Even encrypted keys should not be in repositories"

  # OAuth Client Secret
  - name: oauth_client_secret
    regex: '(?i)client[_-]?secret["\']?\s*[:=]\s*["\']?([A-Za-z0-9_\-]{20,})'
    severity: critical
    description: "OAuth Client Secret"
    remediation: "Rotate OAuth credentials and use environment variables"
    exclude_patterns:
      - placeholder
      - example
      - your[_-]?secret
      - '\$\{'

  # Webhook URLs (various services)
  - name: generic_webhook_url
    regex: 'https://[^/]+/webhooks?/[A-Za-z0-9_\-/]+'
    severity: medium
    description: "Webhook URL"
    remediation: "Consider if webhook URL should be in code"
    exclude_patterns:
      - example\.com
      - localhost

  # Session Secret / Cookie Secret
  - name: session_secret
    regex: '(?i)(session[_-]?secret|cookie[_-]?secret|secret[_-]?key[_-]?base)["\']?\s*[:=]\s*["\']?([A-Za-z0-9_\-]{16,})'
    severity: high
    description: "Session/Cookie Secret Key"
    remediation: "Use environment variables for session secrets"
    exclude_patterns:
      - change[_-]?me
      - placeholder
      - your[_-]?secret

  # Encryption Key
  - name: encryption_key
    regex: '(?i)(encryption[_-]?key|aes[_-]?key|cipher[_-]?key)["\']?\s*[:=]\s*["\']?([A-Za-z0-9+/=]{16,})'
    severity: critical
    description: "Encryption Key"
    remediation: "Use a key management service, never hardcode encryption keys"

  # High Entropy String (generic catch-all)
  - name: high_entropy_string
    regex: '[A-Za-z0-9+/=_\-]{32,}'
    severity: medium
    min_entropy: 5.0
    description: "High entropy string (potential secret)"
    confidence: 0.5
    context_required: true
    context_patterns:
      - secret
      - token
      - key
      - password
      - credential
      - auth
    remediation: "Review if this is a sensitive value that should be externalized"

# =====================================================================
# GLOBAL SETTINGS
# =====================================================================
settings:
  # Entropy threshold for detecting random strings
  entropy_threshold: 4.5
  
  # Maximum line length to analyze (skip very long lines)
  max_line_length: 1000
  
  # Skip test files by default (can be overridden per-scan)
  skip_test_files: false  # Changed to false - test files can contain real secrets!
  
  # Patterns to identify test files
  test_file_patterns:
    - "*_test.*"
    - "test_*.*"
    - "*_spec.*"
    - "*.test.*"
    - "*.spec.*"
    - "**/tests/**"
    - "**/test/**"
    - "**/__tests__/**"
    - "**/fixtures/**"
    - "**/mocks/**"
  
  # Patterns to identify example/template files (lower severity)
  example_file_patterns:
    - "*.example"
    - "*.example.*"
    - "*.sample"
    - "*.sample.*"
    - "*.template"
    - "*.template.*"
    - "**/examples/**"
    - "**/templates/**"
    - "*.md"
    - "README*"
    - "CONTRIBUTING*"
  
  # Files to always skip
  skip_file_patterns:
    - "*.lock"
    - "*.min.js"
    - "*.min.css"
    - "*.map"
    - "*.svg"
    - "*.png"
    - "*.jpg"
    - "*.gif"
    - "*.ico"
    - "*.woff*"
    - "*.ttf"
    - "*.eot"
    - "package-lock.json"
    - "yarn.lock"
    - "Gemfile.lock"
    - "poetry.lock"
    - "Cargo.lock"
    - "go.sum"
  
  # Directories to skip
  skip_directories:
    - node_modules
    - vendor
    - .git
    - __pycache__
    - .venv
    - venv
    - dist
    - build
    - .next
    - .nuxt
    - coverage
    - .pytest_cache
    - .mypy_cache

